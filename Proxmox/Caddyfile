{
    # Global options
    admin off
}

# Site configuration
:443 {
    # Simple Token Authentication
    # We check if the Authorization header matches 'Bearer <MCP_AUTH_TOKEN>'
    @not_authorized {
        not header Authorization "Bearer {$MCP_AUTH_TOKEN}"
    }
    
    respond @not_authorized "Unauthorized" 401

    # Reverse Proxy to the MCP Server
    reverse_proxy proxmox-mcp:8000 {
        # Flush interval is critical for SSE (Server-Sent Events) to work correctly!
        flush_interval -1
    }

    # Enable logging
    log {
        output stdout
    }
}
